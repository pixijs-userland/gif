/*!
 * @pixi/gif - v3.0.1
 * Compiled Wed, 10 Apr 2024 10:14:50 UTC
 *
 * @pixi/gif is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 * 
 * Copyright 2024, Matt Karl @bigtimebuddy, All Rights Reserved
 */this.PIXI=this.PIXI||{},this.PIXI.gif=function(z,y){"use strict";var De=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function K(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function ze(t){return t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Ee(t){return t&&Object.prototype.hasOwnProperty.call(t,"default")&&Object.keys(t).length===1?t.default:t}function Ge(t){if(t.__esModule)return t;var r=t.default;if(typeof r=="function"){var e=function a(){if(this instanceof a){var n=[null];n.push.apply(n,arguments);var i=Function.bind.apply(r,n);return new i}return r.apply(this,arguments)};e.prototype=r.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(t).forEach(function(a){var n=Object.getOwnPropertyDescriptor(t,a);Object.defineProperty(e,a,n.get?n:{enumerable:!0,get:function(){return t[a]}})}),e}var S={},E={},k={};Object.defineProperty(k,"__esModule",{value:!0});var Z=k.loop=W=k.conditional=Q=k.parse=void 0,J=function t(r,e){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:a;if(Array.isArray(e))e.forEach(function(s){return t(r,s,a,n)});else if(typeof e=="function")e(r,a,n,t);else{var i=Object.keys(e)[0];Array.isArray(e[i])?(n[i]={},t(r,e[i],a,n[i])):n[i]=e[i](r,a,n,t)}return a},Q=k.parse=J,V=function(r,e){return function(a,n,i,s){e(a,n,i)&&s(a,r,n,i)}},W=k.conditional=V,ee=function(r,e){return function(a,n,i,s){for(var o=[],c=a.pos;e(a,n,i);){var h={};if(s(a,r,n,h),a.pos===c)break;c=a.pos,o.push(h)}return o}};Z=k.loop=ee;var p={};Object.defineProperty(p,"__esModule",{value:!0});var te=p.readBits=ge=p.readArray=pe=p.readUnsigned=le=p.readString=ue=p.peekBytes=se=p.readBytes=oe=p.peekByte=ne=p.readByte=ae=p.buildStream=void 0,re=function(r){return{data:r,pos:0}},ae=p.buildStream=re,R=function(){return function(r){return r.data[r.pos++]}},ne=p.readByte=R,ie=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(e){return e.data[e.pos+r]}},oe=p.peekByte=ie,O=function(r){return function(e){return e.data.subarray(e.pos,e.pos+=r)}},se=p.readBytes=O,de=function(r){return function(e){return e.data.subarray(e.pos,e.pos+r)}},ue=p.peekBytes=de,ce=function(r){return function(e){return Array.from(O(r)(e)).map(function(a){return String.fromCharCode(a)}).join("")}},le=p.readString=ce,he=function(r){return function(e){var a=O(2)(e);return r?(a[1]<<8)+a[0]:(a[0]<<8)+a[1]}},pe=p.readUnsigned=he,fe=function(r,e){return function(a,n,i){for(var s=typeof e=="function"?e(a,n,i):e,o=O(r),c=new Array(s),h=0;h<s;h++)c[h]=o(a);return c}},ge=p.readArray=fe,ve=function(r,e,a){for(var n=0,i=0;i<a;i++)n+=r[e+i]&&Math.pow(2,a-i-1);return n},ye=function(r){return function(e){for(var a=R()(e),n=new Array(8),i=0;i<8;i++)n[7-i]=!!(a&1<<i);return Object.keys(r).reduce(function(s,o){var c=r[o];return c.length?s[o]=ve(n,c.index,c.length):s[o]=n[c.index],s},{})}};te=p.readBits=ye,function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=k,e=p,a={blocks:function(d){for(var f=0,u=[],w=d.data.length,_=0,v=(0,e.readByte)()(d);v!==f&&v;v=(0,e.readByte)()(d)){if(d.pos+v>=w){var x=w-d.pos;u.push((0,e.readBytes)(x)(d)),_+=x;break}u.push((0,e.readBytes)(v)(d)),_+=v}for(var m=new Uint8Array(_),B=0,b=0;b<u.length;b++)m.set(u[b],B),B+=u[b].length;return m}},n=(0,r.conditional)({gce:[{codes:(0,e.readBytes)(2)},{byteSize:(0,e.readByte)()},{extras:(0,e.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,e.readUnsigned)(!0)},{transparentColorIndex:(0,e.readByte)()},{terminator:(0,e.readByte)()}]},function(l){var d=(0,e.peekBytes)(2)(l);return d[0]===33&&d[1]===249}),i=(0,r.conditional)({image:[{code:(0,e.readByte)()},{descriptor:[{left:(0,e.readUnsigned)(!0)},{top:(0,e.readUnsigned)(!0)},{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{lct:(0,e.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,r.conditional)({lct:(0,e.readArray)(3,function(l,d,f){return Math.pow(2,f.descriptor.lct.size+1)})},function(l,d,f){return f.descriptor.lct.exists}),{data:[{minCodeSize:(0,e.readByte)()},a]}]},function(l){return(0,e.peekByte)()(l)===44}),s=(0,r.conditional)({text:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{preData:function(d,f,u){return(0,e.readBytes)(u.text.blockSize)(d)}},a]},function(l){var d=(0,e.peekBytes)(2)(l);return d[0]===33&&d[1]===1}),o=(0,r.conditional)({application:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{id:function(d,f,u){return(0,e.readString)(u.blockSize)(d)}},a]},function(l){var d=(0,e.peekBytes)(2)(l);return d[0]===33&&d[1]===255}),c=(0,r.conditional)({comment:[{codes:(0,e.readBytes)(2)},a]},function(l){var d=(0,e.peekBytes)(2)(l);return d[0]===33&&d[1]===254}),h=[{header:[{signature:(0,e.readString)(3)},{version:(0,e.readString)(3)}]},{lsd:[{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{gct:(0,e.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,e.readByte)()},{pixelAspectRatio:(0,e.readByte)()}]},(0,r.conditional)({gct:(0,e.readArray)(3,function(l,d){return Math.pow(2,d.lsd.gct.size+1)})},function(l,d){return d.lsd.gct.exists}),{frames:(0,r.loop)([n,o,c,i,s],function(l){var d=(0,e.peekByte)()(l);return d===33||d===44})}],g=h;t.default=g}(E);var je=K(E),P={};Object.defineProperty(P,"__esModule",{value:!0});var me=P.deinterlace=void 0,_e=function(r,e){for(var a=new Array(r.length),n=r.length/e,i=function(d,f){var u=r.slice(f*e,(f+1)*e);a.splice.apply(a,[d*e,e].concat(u))},s=[0,4,2,1],o=[8,8,4,2],c=0,h=0;h<4;h++)for(var g=s[h];g<n;g+=o[h])i(g,c),c++;return a};me=P.deinterlace=_e;var A={};Object.defineProperty(A,"__esModule",{value:!0});var be=A.lzw=void 0,xe=function(r,e,a){var n=4096,i=-1,s=a,o,c,h,g,l,d,f,I,u,w,b,_,F,T,D,M,v=new Array(a),x=new Array(n),m=new Array(n),B=new Array(n+1);for(_=r,c=1<<_,l=c+1,o=c+2,f=i,g=_+1,h=(1<<g)-1,u=0;u<c;u++)x[u]=0,m[u]=u;var b,I,j,F,T,M,D;for(b=I=j=F=T=M=D=0,w=0;w<s;){if(T===0){if(I<g){b+=e[D]<<I,I+=8,D++;continue}if(u=b&h,b>>=g,I-=g,u>o||u==l)break;if(u==c){g=_+1,h=(1<<g)-1,o=c+2,f=i;continue}if(f==i){B[T++]=m[u],f=u,F=u;continue}for(d=u,u==o&&(B[T++]=F,u=f);u>c;)B[T++]=m[u],u=x[u];F=m[u]&255,B[T++]=F,o<n&&(x[o]=f,m[o]=F,o++,!(o&h)&&o<n&&(g++,h+=o)),f=d}T--,v[M++]=B[T],w++}for(w=M;w<s;w++)v[w]=0;return v};be=A.lzw=xe,Object.defineProperty(S,"__esModule",{value:!0});var L=S.decompressFrames=Oe=S.decompressFrame=$=S.parseGIF=void 0,we=Ie(E),Be=k,Te=p,Fe=P,ke=A;function Ie(t){return t&&t.__esModule?t:{default:t}}var Se=function(r){var e=new Uint8Array(r);return(0,Be.parse)((0,Te.buildStream)(e),we.default)},$=S.parseGIF=Se,Ce=function(r){for(var e=r.pixels.length,a=new Uint8ClampedArray(e*4),n=0;n<e;n++){var i=n*4,s=r.pixels[n],o=r.colorTable[s]||[0,0,0];a[i]=o[0],a[i+1]=o[1],a[i+2]=o[2],a[i+3]=s!==r.transparentIndex?255:0}return a},N=function(r,e,a){if(!r.image){console.warn("gif frame does not have associated image.");return}var n=r.image,i=n.descriptor.width*n.descriptor.height,s=(0,ke.lzw)(n.data.minCodeSize,n.data.blocks,i);n.descriptor.lct.interlaced&&(s=(0,Fe.deinterlace)(s,n.descriptor.width));var o={pixels:s,dims:{top:r.image.descriptor.top,left:r.image.descriptor.left,width:r.image.descriptor.width,height:r.image.descriptor.height}};return n.descriptor.lct&&n.descriptor.lct.exists?o.colorTable=n.lct:o.colorTable=e,r.gce&&(o.delay=(r.gce.delay||10)*10,o.disposalType=r.gce.extras.disposal,r.gce.extras.transparentColorGiven&&(o.transparentIndex=r.gce.transparentColorIndex)),a&&(o.patch=Ce(o)),o},Oe=S.decompressFrame=N,Pe=function(r,e){return r.frames.filter(function(a){return a.image}).map(function(a){return N(a,r.gct,e)})};L=S.decompressFrames=Pe;var Ae=Object.defineProperty,U=Object.getOwnPropertySymbols,X=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,H=(t,r,e)=>r in t?Ae(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e,Ue=(t,r)=>{for(var e in r||(r={}))X.call(r,e)&&H(t,e,r[e]);if(U)for(var e of U(r))q.call(r,e)&&H(t,e,r[e]);return t},Me=(t,r)=>{var e={};for(var a in t)X.call(t,a)&&r.indexOf(a)<0&&(e[a]=t[a]);if(t!=null&&U)for(var a of U(t))r.indexOf(a)<0&&q.call(t,a)&&(e[a]=t[a]);return e};const C=class extends y.Sprite{constructor(t,r){super(y.Texture.EMPTY),this.animationSpeed=1,this.loop=!0,this.duration=0,this.autoPlay=!0,this.dirty=!1,this._currentFrame=0,this._autoUpdate=!1,this._isConnectedToTicker=!1,this._playing=!1,this._currentTime=0,this.onRender=()=>this.updateFrame();const e=Object.assign({},C.defaultOptions,r),{scaleMode:a,width:n,height:i}=e,s=Me(e,["scaleMode","width","height"]),o=y.DOMAdapter.get().createCanvas(n,i),c=o.getContext("2d");this.texture=y.Texture.from(o),this.texture.source.scaleMode=a,this.duration=t[t.length-1].end,this._frames=t,this._context=c,this._playing=!1,this._currentTime=0,this._isConnectedToTicker=!1,Object.assign(this,s),this.currentFrame=0,s.autoPlay&&this.play()}static fromBuffer(t,r){if(!t||t.byteLength===0)throw new Error("Invalid buffer");const e=_=>{var v;let x=null;for(const m of _.frames)x=(v=m.gce)!=null?v:x,"image"in m&&!("gce"in m)&&(m.gce=x)},a=$(t);e(a);const n=L(a,!0),i=[],s=y.DOMAdapter.get().createCanvas(a.lsd.width,a.lsd.height),o=s.getContext("2d",{willReadFrequently:!0}),c=y.DOMAdapter.get().createCanvas(),h=c.getContext("2d");let g=0,l=null;const{fps:d}=Object.assign({},C.defaultOptions,r),f=1e3/d;for(let _=0;_<n.length;_++){const{disposalType:v=2,delay:x=f,patch:m,dims:{width:B,height:b,left:I,top:j}}=n[_];c.width=B,c.height=b,h.clearRect(0,0,B,b);const F=h.createImageData(B,b);F.data.set(m),h.putImageData(F,0,0),v===3&&(l=o.getImageData(0,0,s.width,s.height)),o.drawImage(c,I,j);const T=o.getImageData(0,0,s.width,s.height);v===2?o.clearRect(0,0,s.width,s.height):v===3&&o.putImageData(l,0,0),i.push({start:g,end:g+x,imageData:T}),g+=x}s.width=s.height=0,c.width=c.height=0;const{width:u,height:w}=a.lsd;return new C(i,Ue({width:u,height:w},r))}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(y.Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(y.Ticker.shared.add(this.update,this,y.UPDATE_PRIORITY.HIGH),this._isConnectedToTicker=!0),!this.loop&&this.currentFrame===this._frames.length-1&&(this._currentTime=0))}get progress(){return this._currentTime/this.duration}get playing(){return this._playing}update(t){var r,e;if(!this._playing)return;const a=this.animationSpeed*t.deltaTime/y.Ticker.targetFPMS,n=this._currentTime+a,i=n%this.duration,s=this._frames.findIndex(o=>o.start<=i&&o.end>i);n>=this.duration?this.loop?(this._currentTime=i,this.updateFrameIndex(s),(r=this.onLoop)==null||r.call(this)):(this._currentTime=this.duration,this.updateFrameIndex(this._frames.length-1),(e=this.onComplete)==null||e.call(this),this.stop()):(this._currentTime=i,this.updateFrameIndex(s))}updateFrame(){if(!this.dirty)return;const{imageData:t}=this._frames[this._currentFrame];this._context.putImageData(t,0,0),this._context.fillStyle="transparent",this._context.fillRect(0,0,0,1),this.texture.source.update(),this.dirty=!1}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(y.Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(y.Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0))}get currentFrame(){return this._currentFrame}set currentFrame(t){this.updateFrameIndex(t),this._currentTime=this._frames[t].start}updateFrameIndex(t){var r;if(t<0||t>=this._frames.length)throw new Error(`Frame index out of range, expecting 0 to ${this.totalFrames}, got ${t}`);this._currentFrame!==t&&(this._currentFrame=t,this.dirty=!0,(r=this.onFrameChange)==null||r.call(this,t))}get totalFrames(){return this._frames.length}destroy(){this.stop(),super.destroy(!0);const t=null;this._context=t,this._frames=t,this.onComplete=t,this.onFrameChange=t,this.onLoop=t}clone(){const t=new C([...this._frames],{autoUpdate:this._autoUpdate,loop:this.loop,autoPlay:this.autoPlay,scaleMode:this.texture.source.scaleMode,animationSpeed:this.animationSpeed,width:this._context.canvas.width,height:this._context.canvas.height,onComplete:this.onComplete,onFrameChange:this.onFrameChange,onLoop:this.onLoop});return t.dirty=!0,t}};let G=C;G.defaultOptions={scaleMode:"linear",fps:30,loop:!0,animationSpeed:1,autoPlay:!0,autoUpdate:!0,onComplete:null,onFrameChange:null,onLoop:null};const Y={extension:y.ExtensionType.Asset,detection:{test:async()=>!0,add:async t=>[...t,"gif"],remove:async t=>t.filter(r=>r!=="gif")},loader:{name:"gifLoader",test:t=>y.path.extname(t)===".gif",load:async(t,r)=>{const e=await(await y.DOMAdapter.get().fetch(t)).arrayBuffer();return G.fromBuffer(e,r==null?void 0:r.data)},unload:async t=>{t.destroy()}}};return y.extensions.add(Y),z.AnimatedGIF=G,z.AnimatedGIFAsset=Y,z}({},PIXI);
//# sourceMappingURL=pixi-gif.js.map
