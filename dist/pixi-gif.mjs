/*!
 * @pixi/gif - v3.0.1
 * Compiled Wed, 10 Apr 2024 10:14:50 UTC
 *
 * @pixi/gif is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 * 
 * Copyright 2024, Matt Karl @bigtimebuddy, All Rights Reserved
 */import{Sprite as Z,Texture as R,DOMAdapter as P,Ticker as k,UPDATE_PRIORITY as J,ExtensionType as Q,path as V,extensions as W}from"pixi.js";var $e=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function ee(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Ne(t){return t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function qe(t){return t&&Object.prototype.hasOwnProperty.call(t,"default")&&Object.keys(t).length===1?t.default:t}function He(t){if(t.__esModule)return t;var r=t.default;if(typeof r=="function"){var e=function a(){if(this instanceof a){var n=[null];n.push.apply(n,arguments);var i=Function.bind.apply(r,n);return new i}return r.apply(this,arguments)};e.prototype=r.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(t).forEach(function(a){var n=Object.getOwnPropertyDescriptor(t,a);Object.defineProperty(e,a,n.get?n:{enumerable:!0,get:function(){return t[a]}})}),e}var C={},E={},F={};Object.defineProperty(F,"__esModule",{value:!0});var te=F.loop=ie=F.conditional=ae=F.parse=void 0,re=function t(r,e){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:a;if(Array.isArray(e))e.forEach(function(s){return t(r,s,a,n)});else if(typeof e=="function")e(r,a,n,t);else{var i=Object.keys(e)[0];Array.isArray(e[i])?(n[i]={},t(r,e[i],a,n[i])):n[i]=e[i](r,a,n,t)}return a},ae=F.parse=re,ne=function(r,e){return function(a,n,i,s){e(a,n,i)&&s(a,r,n,i)}},ie=F.conditional=ne,oe=function(r,e){return function(a,n,i,s){for(var o=[],c=a.pos;e(a,n,i);){var p={};if(s(a,r,n,p),a.pos===c)break;c=a.pos,o.push(p)}return o}};te=F.loop=oe;var h={};Object.defineProperty(h,"__esModule",{value:!0});var se=h.readBits=be=h.readArray=_e=h.readUnsigned=ye=h.readString=ge=h.peekBytes=he=h.readBytes=pe=h.peekByte=ce=h.readByte=ue=h.buildStream=void 0,de=function(r){return{data:r,pos:0}},ue=h.buildStream=de,L=function(){return function(r){return r.data[r.pos++]}},ce=h.readByte=L,le=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(e){return e.data[e.pos+r]}},pe=h.peekByte=le,U=function(r){return function(e){return e.data.subarray(e.pos,e.pos+=r)}},he=h.readBytes=U,fe=function(r){return function(e){return e.data.subarray(e.pos,e.pos+r)}},ge=h.peekBytes=fe,ve=function(r){return function(e){return Array.from(U(r)(e)).map(function(a){return String.fromCharCode(a)}).join("")}},ye=h.readString=ve,me=function(r){return function(e){var a=U(2)(e);return r?(a[1]<<8)+a[0]:(a[0]<<8)+a[1]}},_e=h.readUnsigned=me,xe=function(r,e){return function(a,n,i){for(var s=typeof e=="function"?e(a,n,i):e,o=U(r),c=new Array(s),p=0;p<s;p++)c[p]=o(a);return c}},be=h.readArray=xe,we=function(r,e,a){for(var n=0,i=0;i<a;i++)n+=r[e+i]&&Math.pow(2,a-i-1);return n},Be=function(r){return function(e){for(var a=L()(e),n=new Array(8),i=0;i<8;i++)n[7-i]=!!(a&1<<i);return Object.keys(r).reduce(function(s,o){var c=r[o];return c.length?s[o]=we(n,c.index,c.length):s[o]=n[c.index],s},{})}};se=h.readBits=Be,function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=F,e=h,a={blocks:function(d){for(var f=0,u=[],b=d.data.length,m=0,v=(0,e.readByte)()(d);v!==f&&v;v=(0,e.readByte)()(d)){if(d.pos+v>=b){var x=b-d.pos;u.push((0,e.readBytes)(x)(d)),m+=x;break}u.push((0,e.readBytes)(v)(d)),m+=v}for(var y=new Uint8Array(m),w=0,_=0;_<u.length;_++)y.set(u[_],w),w+=u[_].length;return y}},n=(0,r.conditional)({gce:[{codes:(0,e.readBytes)(2)},{byteSize:(0,e.readByte)()},{extras:(0,e.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,e.readUnsigned)(!0)},{transparentColorIndex:(0,e.readByte)()},{terminator:(0,e.readByte)()}]},function(l){var d=(0,e.peekBytes)(2)(l);return d[0]===33&&d[1]===249}),i=(0,r.conditional)({image:[{code:(0,e.readByte)()},{descriptor:[{left:(0,e.readUnsigned)(!0)},{top:(0,e.readUnsigned)(!0)},{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{lct:(0,e.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,r.conditional)({lct:(0,e.readArray)(3,function(l,d,f){return Math.pow(2,f.descriptor.lct.size+1)})},function(l,d,f){return f.descriptor.lct.exists}),{data:[{minCodeSize:(0,e.readByte)()},a]}]},function(l){return(0,e.peekByte)()(l)===44}),s=(0,r.conditional)({text:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{preData:function(d,f,u){return(0,e.readBytes)(u.text.blockSize)(d)}},a]},function(l){var d=(0,e.peekBytes)(2)(l);return d[0]===33&&d[1]===1}),o=(0,r.conditional)({application:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{id:function(d,f,u){return(0,e.readString)(u.blockSize)(d)}},a]},function(l){var d=(0,e.peekBytes)(2)(l);return d[0]===33&&d[1]===255}),c=(0,r.conditional)({comment:[{codes:(0,e.readBytes)(2)},a]},function(l){var d=(0,e.peekBytes)(2)(l);return d[0]===33&&d[1]===254}),p=[{header:[{signature:(0,e.readString)(3)},{version:(0,e.readString)(3)}]},{lsd:[{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{gct:(0,e.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,e.readByte)()},{pixelAspectRatio:(0,e.readByte)()}]},(0,r.conditional)({gct:(0,e.readArray)(3,function(l,d){return Math.pow(2,d.lsd.gct.size+1)})},function(l,d){return d.lsd.gct.exists}),{frames:(0,r.loop)([n,o,c,i,s],function(l){var d=(0,e.peekByte)()(l);return d===33||d===44})}],g=p;t.default=g}(E);var Ye=ee(E),j={};Object.defineProperty(j,"__esModule",{value:!0});var Te=j.deinterlace=void 0,Fe=function(r,e){for(var a=new Array(r.length),n=r.length/e,i=function(d,f){var u=r.slice(f*e,(f+1)*e);a.splice.apply(a,[d*e,e].concat(u))},s=[0,4,2,1],o=[8,8,4,2],c=0,p=0;p<4;p++)for(var g=s[p];g<n;g+=o[p])i(g,c),c++;return a};Te=j.deinterlace=Fe;var M={};Object.defineProperty(M,"__esModule",{value:!0});var Se=M.lzw=void 0,Ce=function(r,e,a){var n=4096,i=-1,s=a,o,c,p,g,l,d,f,S,u,b,_,m,T,B,A,O,v=new Array(a),x=new Array(n),y=new Array(n),w=new Array(n+1);for(m=r,c=1<<m,l=c+1,o=c+2,f=i,g=m+1,p=(1<<g)-1,u=0;u<c;u++)x[u]=0,y[u]=u;var _,S,z,T,B,O,A;for(_=S=z=T=B=O=A=0,b=0;b<s;){if(B===0){if(S<g){_+=e[A]<<S,S+=8,A++;continue}if(u=_&p,_>>=g,S-=g,u>o||u==l)break;if(u==c){g=m+1,p=(1<<g)-1,o=c+2,f=i;continue}if(f==i){w[B++]=y[u],f=u,T=u;continue}for(d=u,u==o&&(w[B++]=T,u=f);u>c;)w[B++]=y[u],u=x[u];T=y[u]&255,w[B++]=T,o<n&&(x[o]=f,y[o]=T,o++,!(o&p)&&o<n&&(g++,p+=o)),f=d}B--,v[O++]=w[B],b++}for(b=O;b<s;b++)v[b]=0;return v};Se=M.lzw=Ce,Object.defineProperty(C,"__esModule",{value:!0});var $=C.decompressFrames=De=C.decompressFrame=N=C.parseGIF=void 0,ke=Ue(E),Ie=F,Oe=h,Ae=j,Pe=M;function Ue(t){return t&&t.__esModule?t:{default:t}}var je=function(r){var e=new Uint8Array(r);return(0,Ie.parse)((0,Oe.buildStream)(e),ke.default)},N=C.parseGIF=je,Me=function(r){for(var e=r.pixels.length,a=new Uint8ClampedArray(e*4),n=0;n<e;n++){var i=n*4,s=r.pixels[n],o=r.colorTable[s]||[0,0,0];a[i]=o[0],a[i+1]=o[1],a[i+2]=o[2],a[i+3]=s!==r.transparentIndex?255:0}return a},q=function(r,e,a){if(!r.image){console.warn("gif frame does not have associated image.");return}var n=r.image,i=n.descriptor.width*n.descriptor.height,s=(0,Pe.lzw)(n.data.minCodeSize,n.data.blocks,i);n.descriptor.lct.interlaced&&(s=(0,Ae.deinterlace)(s,n.descriptor.width));var o={pixels:s,dims:{top:r.image.descriptor.top,left:r.image.descriptor.left,width:r.image.descriptor.width,height:r.image.descriptor.height}};return n.descriptor.lct&&n.descriptor.lct.exists?o.colorTable=n.lct:o.colorTable=e,r.gce&&(o.delay=(r.gce.delay||10)*10,o.disposalType=r.gce.extras.disposal,r.gce.extras.transparentColorGiven&&(o.transparentIndex=r.gce.transparentColorIndex)),a&&(o.patch=Me(o)),o},De=C.decompressFrame=q,ze=function(r,e){return r.frames.filter(function(a){return a.image}).map(function(a){return q(a,r.gct,e)})};$=C.decompressFrames=ze;var Ee=Object.defineProperty,D=Object.getOwnPropertySymbols,H=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable,K=(t,r,e)=>r in t?Ee(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e,Ge=(t,r)=>{for(var e in r||(r={}))H.call(r,e)&&K(t,e,r[e]);if(D)for(var e of D(r))Y.call(r,e)&&K(t,e,r[e]);return t},Re=(t,r)=>{var e={};for(var a in t)H.call(t,a)&&r.indexOf(a)<0&&(e[a]=t[a]);if(t!=null&&D)for(var a of D(t))r.indexOf(a)<0&&Y.call(t,a)&&(e[a]=t[a]);return e};const I=class extends Z{constructor(t,r){super(R.EMPTY),this.animationSpeed=1,this.loop=!0,this.duration=0,this.autoPlay=!0,this.dirty=!1,this._currentFrame=0,this._autoUpdate=!1,this._isConnectedToTicker=!1,this._playing=!1,this._currentTime=0,this.onRender=()=>this.updateFrame();const e=Object.assign({},I.defaultOptions,r),{scaleMode:a,width:n,height:i}=e,s=Re(e,["scaleMode","width","height"]),o=P.get().createCanvas(n,i),c=o.getContext("2d");this.texture=R.from(o),this.texture.source.scaleMode=a,this.duration=t[t.length-1].end,this._frames=t,this._context=c,this._playing=!1,this._currentTime=0,this._isConnectedToTicker=!1,Object.assign(this,s),this.currentFrame=0,s.autoPlay&&this.play()}static fromBuffer(t,r){if(!t||t.byteLength===0)throw new Error("Invalid buffer");const e=m=>{var v;let x=null;for(const y of m.frames)x=(v=y.gce)!=null?v:x,"image"in y&&!("gce"in y)&&(y.gce=x)},a=N(t);e(a);const n=$(a,!0),i=[],s=P.get().createCanvas(a.lsd.width,a.lsd.height),o=s.getContext("2d",{willReadFrequently:!0}),c=P.get().createCanvas(),p=c.getContext("2d");let g=0,l=null;const{fps:d}=Object.assign({},I.defaultOptions,r),f=1e3/d;for(let m=0;m<n.length;m++){const{disposalType:v=2,delay:x=f,patch:y,dims:{width:w,height:_,left:S,top:z}}=n[m];c.width=w,c.height=_,p.clearRect(0,0,w,_);const T=p.createImageData(w,_);T.data.set(y),p.putImageData(T,0,0),v===3&&(l=o.getImageData(0,0,s.width,s.height)),o.drawImage(c,S,z);const B=o.getImageData(0,0,s.width,s.height);v===2?o.clearRect(0,0,s.width,s.height):v===3&&o.putImageData(l,0,0),i.push({start:g,end:g+x,imageData:B}),g+=x}s.width=s.height=0,c.width=c.height=0;const{width:u,height:b}=a.lsd;return new I(i,Ge({width:u,height:b},r))}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(k.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(k.shared.add(this.update,this,J.HIGH),this._isConnectedToTicker=!0),!this.loop&&this.currentFrame===this._frames.length-1&&(this._currentTime=0))}get progress(){return this._currentTime/this.duration}get playing(){return this._playing}update(t){var r,e;if(!this._playing)return;const a=this.animationSpeed*t.deltaTime/k.targetFPMS,n=this._currentTime+a,i=n%this.duration,s=this._frames.findIndex(o=>o.start<=i&&o.end>i);n>=this.duration?this.loop?(this._currentTime=i,this.updateFrameIndex(s),(r=this.onLoop)==null||r.call(this)):(this._currentTime=this.duration,this.updateFrameIndex(this._frames.length-1),(e=this.onComplete)==null||e.call(this),this.stop()):(this._currentTime=i,this.updateFrameIndex(s))}updateFrame(){if(!this.dirty)return;const{imageData:t}=this._frames[this._currentFrame];this._context.putImageData(t,0,0),this._context.fillStyle="transparent",this._context.fillRect(0,0,0,1),this.texture.source.update(),this.dirty=!1}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(k.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(k.shared.add(this.update,this),this._isConnectedToTicker=!0))}get currentFrame(){return this._currentFrame}set currentFrame(t){this.updateFrameIndex(t),this._currentTime=this._frames[t].start}updateFrameIndex(t){var r;if(t<0||t>=this._frames.length)throw new Error(`Frame index out of range, expecting 0 to ${this.totalFrames}, got ${t}`);this._currentFrame!==t&&(this._currentFrame=t,this.dirty=!0,(r=this.onFrameChange)==null||r.call(this,t))}get totalFrames(){return this._frames.length}destroy(){this.stop(),super.destroy(!0);const t=null;this._context=t,this._frames=t,this.onComplete=t,this.onFrameChange=t,this.onLoop=t}clone(){const t=new I([...this._frames],{autoUpdate:this._autoUpdate,loop:this.loop,autoPlay:this.autoPlay,scaleMode:this.texture.source.scaleMode,animationSpeed:this.animationSpeed,width:this._context.canvas.width,height:this._context.canvas.height,onComplete:this.onComplete,onFrameChange:this.onFrameChange,onLoop:this.onLoop});return t.dirty=!0,t}};let G=I;G.defaultOptions={scaleMode:"linear",fps:30,loop:!0,animationSpeed:1,autoPlay:!0,autoUpdate:!0,onComplete:null,onFrameChange:null,onLoop:null};const X={extension:Q.Asset,detection:{test:async()=>!0,add:async t=>[...t,"gif"],remove:async t=>t.filter(r=>r!=="gif")},loader:{name:"gifLoader",test:t=>V.extname(t)===".gif",load:async(t,r)=>{const e=await(await P.get().fetch(t)).arrayBuffer();return G.fromBuffer(e,r==null?void 0:r.data)},unload:async t=>{t.destroy()}}};W.add(X);export{G as AnimatedGIF,X as AnimatedGIFAsset};
//# sourceMappingURL=pixi-gif.mjs.map
